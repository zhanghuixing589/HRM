# 应用配置
spring.application.name=HRM
server.port=8080

# 数据库配置
spring.datasource.url=jdbc:mysql://47.110.69.50:3306/HRM?\
  useUnicode=true&\
  characterEncoding=UTF-8&\
  useSSL=false&\
  serverTimezone=Asia/Shanghai&\
  allowPublicKeyRetrieval=true&\
  zeroDateTimeBehavior=convertToNull&\
  rewriteBatchedStatements=true&\
  useJDBCCompliantTimezoneShift=true&\
  useLegacyDatetimeCode=false
spring.datasource.username=remote_user
spring.datasource.password=1234567
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA配置
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.connection.characterEncoding=utf8
spring.jpa.properties.hibernate.connection.useUnicode=true
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
spring.jpa.hibernate.naming.implicit-strategy=org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl

# JWT配置
jwt.secret=hrmSecretKey2025@MoonshotAI
jwt.expiration=43200000
jwt.token-prefix=Bearer
jwt.header=Authorization

# 解决循环依赖
spring.main.allow-circular-references=true

# 静态资源路径
spring.resources.static-locations=classpath:/static/,classpath:/public/
# 欢迎页面
spring.mvc.index=index.html
# 启用默认欢迎页面
spring.web.resources.add-mappings=true

# Hibernate SQL日志
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true

# 更详细的日志级别
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.hibernate.engine.jdbc.spi.SqlExceptionHelper=DEBUG
logging.level.org.springframework.orm.jpa=DEBUG
logging.level.org.springframework.transaction=DEBUG

# 日志配置 - 解决乱码
logging.charset.console=UTF-8
logging.charset.file=UTF-8
logging.file.name=logs/hrm.log

# 日志级别
logging.level.root=INFO
logging.level.org.example.hrm=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type=TRACE


# CORS配置（部分Spring Boot版本支持）
spring.mvc.cors.allowed-origins=http://localhost:8081
spring.mvc.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.mvc.cors.allowed-headers=*
spring.mvc.cors.allow-credentials=true
spring.mvc.cors.max-age=3600

# Jackson JSON 配置 - 解决响应乱码
# ===============================
spring.jackson.date-format=yyyy-MM-dd HH:mm:ss
spring.jackson.time-zone=Asia/Shanghai
spring.jackson.default-property-inclusion=non_null
spring.jackson.serialization.indent-output=true
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.write-date-timestamps-as-nanoseconds=false
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.locale=zh_CN
spring.jackson.encoding.charset=UTF-8

# 显示SQL语句
logging.level.org.hibernate.SQL=DEBUG
# 显示SQL参数
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
# 显示事务日志
logging.level.org.springframework.transaction=DEBUG
# 显示JDBC异常详情
logging.level.org.hibernate.engine.jdbc.spi.SqlExceptionHelper=ERROR


# 新增：HikariCP连接池优化
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.pool-name=HRM-HikariCP

# 新增：MySQL连接优化
spring.datasource.hikari.data-source-properties.cachePrepStmts=true
spring.datasource.hikari.data-source-properties.prepStmtCacheSize=250
spring.datasource.hikari.data-source-properties.prepStmtCacheSqlLimit=2048
spring.datasource.hikari.data-source-properties.useServerPrepStmts=true
spring.datasource.hikari.data-source-properties.useLocalSessionState=true
spring.datasource.hikari.data-source-properties.rewriteBatchedStatements=true
spring.datasource.hikari.data-source-properties.cacheResultSetMetadata=true
spring.datasource.hikari.data-source-properties.cacheServerConfiguration=true
spring.datasource.hikari.data-source-properties.elideSetAutoCommits=true
spring.datasource.hikari.data-source-properties.maintainTimeStats=false

# 新增：Tomcat线程池优化
server.tomcat.max-threads=200
server.tomcat.min-spare-threads=20
server.tomcat.max-connections=10000
server.tomcat.accept-count=100
server.tomcat.connection-timeout=30000
server.tomcat.keep-alive-timeout=60000

# 新增：HTTP连接超时
server.connection-timeout=30000
server.max-http-header-size=8192
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# 新增：Spring MVC优化
spring.mvc.async.request-timeout=60000
spring.mvc.servlet.load-on-startup=1
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# 新增：Jackson性能优化
spring.jackson.parser.allow-unquoted-control-chars=true
spring.jackson.parser.allow-single-quotes=true
spring.jackson.parser.allow-numeric-leading-zeros=true
spring.jackson.parser.allow-backslash-escaping-any-character=true
spring.jackson.parser.allow-unquoted-field-names=true
spring.jackson.parser.allow-comments=true

# 修改：JPA性能优化
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.query.fail_on_pagination_over_collection_fetch=true
spring.jpa.properties.hibernate.default_batch_fetch_size=20
spring.jpa.properties.hibernate.generate_statistics=false

# 新增：事务管理优化
spring.jpa.open-in-view=false
spring.transaction.default-timeout=30

# 新增：缓存配置
spring.cache.type=simple
spring.cache.cache-names=positions,projects,enums
spring.cache.simple.time-to-live=600000

# 减少详细日志输出（生产环境）
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=DEBUG
# logging.level.org.hibernate.SQL=DEBUG  # 生产环境可改为INFO

# 静态资源映射
file.upload.path=C:/tmp/upload/
spring.resources.static-locations=file:C:/tmp/upload/